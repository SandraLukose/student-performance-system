<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Account | Student Performance System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="background-decoration">
    <div class="circle circle-1"></div>
    <div class="circle circle-2"></div>
    <div class="circle circle-3"></div>
</div>

<div class="signup-container">
    <!-- Logo/Icon Section -->
    <div class="signup-header">
        <div class="signup-icon-wrapper">
            <svg class="signup-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                <circle cx="8.5" cy="7" r="4"/>
                <line x1="20" y1="8" x2="20" y2="14"/>
                <line x1="23" y1="11" x2="17" y2="11"/>
            </svg>
        </div>
        <h1>Create Account</h1>
        <p class="signup-subtitle">Join the Student Performance System</p>
    </div>

    <!-- Error Message -->
    {% if error %}
    <div class="error-message animate-shake">
        <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <div>
            <strong>Signup Failed</strong>
            <p>{{ error }}</p>
        </div>
    </div>
    {% endif %}

    <!-- Signup Form -->
    <form method="POST" class="signup-form" id="signupForm">
        <div class="form-group">
            <label for="username">
                <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                Username
            </label>
            <input 
                type="text" 
                id="username"
                name="username" 
                placeholder="Choose a unique username" 
                required
                autocomplete="username"
                minlength="3"
                maxlength="20"
                autofocus>
            <span class="input-hint">3-20 characters, letters and numbers only</span>
        </div>

        <div class="form-group">
            <label for="password">
                <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0110 0v4"/>
                </svg>
                Password
            </label>
            <div class="password-wrapper">
                <input 
                    type="password" 
                    id="password"
                    name="password" 
                    placeholder="Create a strong password" 
                    required
                    autocomplete="new-password"
                    minlength="6">
                <button type="button" class="toggle-password" onclick="togglePassword()" aria-label="Toggle password visibility">
                    <svg id="eyeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </button>
            </div>
            <span class="input-hint">Minimum 6 characters</span>
            
            <!-- Password Strength Indicator -->
            <div class="password-strength">
                <div class="strength-bars">
                    <div class="strength-bar" id="bar1"></div>
                    <div class="strength-bar" id="bar2"></div>
                    <div class="strength-bar" id="bar3"></div>
                    <div class="strength-bar" id="bar4"></div>
                </div>
                <span class="strength-text" id="strengthText">Password strength</span>
            </div>
        </div>

        <div class="form-group">
            <label for="confirm-password">
                <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                </svg>
                Confirm Password
            </label>
            <div class="password-wrapper">
                <input 
                    type="password" 
                    id="confirm-password"
                    placeholder="Re-enter your password" 
                    required
                    autocomplete="new-password">
                <span class="password-match-icon" id="matchIcon"></span>
            </div>
            <span class="input-hint" id="matchHint"></span>
        </div>

        <div class="form-options">
            <label class="checkbox-label">
                <input type="checkbox" id="terms" required>
                <span class="checkbox-custom"></span>
                <span class="checkbox-text">I agree to the <a href="#" class="terms-link">Terms & Conditions</a></span>
            </label>
        </div>

        <button type="submit" class="signup-btn" id="submitBtn">
            <span class="btn-text">Create Account</span>
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12h14"/>
                <path d="M12 5l7 7-7 7"/>
            </svg>
        </button>
    </form>

    <!-- Login Link -->
    <div class="alternate-action">
        <p>Already have an account? <a href="/login" class="action-link">Sign In</a></p>
    </div>

    <!-- Features Info -->
    <div class="signup-features">
        <div class="feature-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
            <span>Secure Account</span>
        </div>
        <div class="feature-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
            </svg>
            <span>Performance Tracking</span>
        </div>
        <div class="feature-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>
            </svg>
            <span>Free to Use</span>
        </div>
    </div>

    <!-- Footer -->
    <div class="signup-footer">
        <p>&copy; 2024 Student Performance System. All rights reserved.</p>
    </div>
</div>

<script>
    // Toggle password visibility
    function togglePassword() {
        const passwordInput = document.getElementById('password');
        const eyeIcon = document.getElementById('eyeIcon');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            eyeIcon.innerHTML = `
                <path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
            `;
        } else {
            passwordInput.type = 'password';
            eyeIcon.innerHTML = `
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
            `;
        }
    }

    // Password strength checker
    const passwordInput = document.getElementById('password');
    const strengthText = document.getElementById('strengthText');
    const bars = [
        document.getElementById('bar1'),
        document.getElementById('bar2'),
        document.getElementById('bar3'),
        document.getElementById('bar4')
    ];

    function checkPasswordStrength(password) {
        let strength = 0;
        
        if (password.length >= 6) strength++;
        if (password.length >= 10) strength++;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
        if (/\d/.test(password)) strength++;
        if (/[^a-zA-Z\d]/.test(password)) strength++;
        
        return Math.min(strength, 4);
    }

    passwordInput.addEventListener('input', function() {
        const password = this.value;
        const strength = checkPasswordStrength(password);
        
        // Reset all bars
        bars.forEach(bar => {
            bar.className = 'strength-bar';
        });
        
        // Update bars based on strength
        const strengthLevels = ['weak', 'fair', 'good', 'strong'];
        const strengthTexts = ['Weak password', 'Fair password', 'Good password', 'Strong password'];
        
        for (let i = 0; i < strength; i++) {
            bars[i].classList.add(strengthLevels[Math.min(strength - 1, 3)]);
        }
        
        if (password.length > 0) {
            strengthText.textContent = strengthTexts[Math.min(strength - 1, 3)] || 'Too short';
            strengthText.className = 'strength-text ' + (strengthLevels[Math.min(strength - 1, 3)] || 'weak');
        } else {
            strengthText.textContent = 'Password strength';
            strengthText.className = 'strength-text';
        }
        
        checkPasswordMatch();
    });

    // Password match checker
    const confirmPassword = document.getElementById('confirm-password');
    const matchIcon = document.getElementById('matchIcon');
    const matchHint = document.getElementById('matchHint');

    function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirm = confirmPassword.value;
        
        if (confirm.length === 0) {
            matchIcon.className = 'password-match-icon';
            matchHint.textContent = '';
            return;
        }
        
        if (password === confirm) {
            matchIcon.className = 'password-match-icon match';
            matchIcon.innerHTML = '✓';
            matchHint.textContent = 'Passwords match';
            matchHint.style.color = '#10b981';
        } else {
            matchIcon.className = 'password-match-icon no-match';
            matchIcon.innerHTML = '✗';
            matchHint.textContent = 'Passwords do not match';
            matchHint.style.color = '#ef4444';
        }
    }

    confirmPassword.addEventListener('input', checkPasswordMatch);

    // Username validation
    const usernameInput = document.getElementById('username');
    usernameInput.addEventListener('input', function() {
        this.value = this.value.replace(/[^a-zA-Z0-9_]/g, '');
    });

    // Form submission
    const signupForm = document.getElementById('signupForm');
    const submitBtn = document.getElementById('submitBtn');

    signupForm.addEventListener('submit', function(e) {
        const password = passwordInput.value;
        const confirm = confirmPassword.value;
        
        if (password !== confirm) {
            e.preventDefault();
            confirmPassword.focus();
            matchHint.textContent = 'Passwords must match!';
            matchHint.style.color = '#ef4444';
            return false;
        }
        
        const btnText = submitBtn.querySelector('.btn-text');
        submitBtn.classList.add('loading');
        submitBtn.disabled = true;
        btnText.textContent = 'Creating Account...';
    });

    // Prevent multiple submissions
    let formSubmitted = false;
    signupForm.addEventListener('submit', function(e) {
        if (formSubmitted) {
            e.preventDefault();
            return false;
        }
        formSubmitted = true;
    });

    // Enhanced input validation
    const inputs = document.querySelectorAll('input[type="text"], input[type="password"]');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            const errorMsg = document.querySelector('.error-message');
            if (errorMsg) {
                errorMsg.style.opacity = '0.5';
            }
        });
    });
</script>

</body>
</html>